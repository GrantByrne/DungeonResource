@using DungeonResource.Web.Models
@model DungeonResource.Components.Domain.Spell.Spell

@{
    ViewBag.Title = "Create";
}

<script>

    var myApp = angular.module('myApp', []);

    myApp.controller('CreateSpellController', ['$scope', '$log', '$http', function ($scope, $log, $http) {

        $scope.spell = {};

        $scope.addSpellLevel = function () {

            if ($scope.spell.SpellLevels === undefined) {
                $scope.spell.SpellLevels = [];
            }

            var spellLevel = {
                SpellClass: $scope.spellClass,
                Level: $scope.spellLevel
            };

            $scope.spell.SpellLevels.push(spellLevel);

            $scope.spellClass = undefined;
            $scope.spellLevel = undefined;

        };

        $scope.remove = function (array, index) {
            array.splice(index, 1);
        };

        $scope.addSpell = function () {

            // Show the Loading modal

            var config = {
                method: 'POST',
                url: 'Create',
                data: $scope.spell
            };

            $log.log("1");

            $http(config).
              success(function (data) {

                  $log.log("2");


                  // Move the user back to the homepage
                  document.URL("/");

              }).
              error(function (data, status, headers, config) {

                  $log.log("3");


                  // Report to the user that an error has occured
                  $scope.saveError = true;

                  // Write the error information to the log
                  $log.error(data);
                  $log.error(status);
                  $log.error(headers);
                  $log.error(config);

              });

        };

        $scope.saveError = false;
    }]);

</script>



<div class="form-signin" ng-app="myApp" ng-controller="CreateSpellController">

    <h2>Create Spell</h2>

    <br />

    <form role="form" name="form">

        @*Spell Name*@
        <div class="form-group">
            <label for="spellName">Spell Name</label>
            <input type="text" class="form-control" name="spellName" id="spellName" placeholder="Enter spell name" ng-model="spell.Name" required>
            <span ng-show="form.spellName.$dirty && form.spellName.$invalid" class="label label-danger">Please Enter a Spell Name</span>
        </div>

        @*Target*@
        <div class="form-group">
            <label for="spellTarget">Target</label>
            <input type="text" class="form-control" name="spellTarget" id="spellTarget" placeholder="Enter spell target" ng-model="spell.Targets" required>
            <span ng-show="form.spellTarget.$dirty && form.spellTarget.$invalid" class="label label-danger">Please Enter a Target</span>
        </div>

        @*Casting Time*@
        <div class="form-group">
            <label for="spellCastingTime">Casting Time</label>
            <input type="text" class="form-control" name="spellCastingTime" id="spellCastingTime" placeholder="Enter casting time" ng-model="spell.CastingTime" required>
            <span ng-show="form.spellCastingTime.$dirty && form.spellCastingTime.$invalid" class="label label-danger">Please Enter a Casting Time</span>
        </div>

        @*Duration*@
        <div class="form-group">
            <label for="spellDuration">Duration</label>
            <input type="text" class="form-control" name="spellDuration" id="spellDuration" placeholder="Enter spell duration" ng-model="spell.Duration" required>
            <span ng-show="form.spellDuration.$dirty && form.spellDuration.$invalid" class="label label-danger">Please Enter a Spell Duration</span>     
        </div>

        @*Range*@
        <div class="form-group">
            <div>
                <label for="spellRange">Spell Range</label>
            </div>
            <div class="btn-group" id="spellRange" data-toggle="buttons">
                <label class="btn btn-primary">
                    <input type="radio" name="options" id="option0"> Self
                </label>
                <label class="btn btn-primary">
                    <input type="radio" name="options" id="option1"> Touch
                </label>
                <label class="btn btn-primary">
                    <input type="radio" name="options" id="option2"> Close
                </label>
                <label class="btn btn-primary">
                    <input type="radio" name="options" id="option3"> Medium
                </label>
                <label class="btn btn-primary">
                    <input type="radio" name="options" id="option4"> Long
                </label>
            </div>
        </div>

        @*Attributes*@
        <div class="form-group">
            <div>
                <label for="spellImportant">Important</label>
            </div>
            <div class="btn-group" id="spellImportant" data-toggle="buttons">
                <label class="btn btn-primary">
                    <input ng-model="spell.SpellResistance" type="checkbox"> Spell Resistance
                </label>
                <label class="btn btn-primary">
                    <input ng-model="spell.SavingThrow" type="checkbox"> Saving Throw
                </label>
            </div>
        </div>

        @*Components*@
        <div class="form-group">
            <div>
                <label for="spellComponents">Components</label>
            </div>
            <div class="btn-group" id="spellComponents" data-toggle="buttons">
                <label class="btn btn-primary">
                    <input ng-model="spell.Verbal" type="checkbox"> Verbal
                </label>
                <label class="btn btn-primary">
                    <input ng-model="spell.Somatic" type="checkbox"> Somatic
                </label>
                <label class="btn btn-primary">
                    <input ng-model="spell.Material" type="checkbox"> Material
                </label>
                <label class="btn btn-primary">
                    <input ng-model="spell.Focus" type="checkbox"> Focus
                </label>
            </div>
        </div>

        @*Class Levels*@
        <div class="form-group">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Class Name</th>
                        <th>Level</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="spellLevel in spell.SpellLevels">
                        <td>{{spellLevel.SpellClass}}</td>
                        <td>{{spellLevel.Level}}</td>
                        <td><a href="" class="btn btn-primary" ng-click="remove(spell.SpellLevels, $index)">Remove</a></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="form-group">
            <div class="form-inline">
                <div class="form-group">
                    <input type="text" id="className" placeholder="Class Name" ng-model="spellClass" />
                </div>
                <div class="form-group">
                    <input type="number" id="spellLevel" placeholder="Class Level" ng-model="spellLevel" />
                </div>
                <div class="form-group">
                    <a href="" class="btn btn-primary" ng-click="addSpellLevel()">Add</a>
                </div>
            </div>
        </div>

        @*Description*@
        <div class="form-group">
            <textarea class="form-control" rows="3" ng-model="spell.Description" required></textarea>
            <span ng-show="form.spellCastingTime.$dirty && form.spellCastingTime.$invalid" class="label label-danger">Please Enter a Casting Time</span>
        </div>

        @*Submit*@
        <div class="form-group">
            <input type="button" value="Add" class="btn btn-primary" data-toggle="modal" data-target="#myModal" ng-click="addSpell()" />
        </div>

    </form>

    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <h2>Loading...</h2>
                    <div class="progress progress-striped active">
                        <div class="progress-bar" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: 45%">
                            <span class="sr-only">45% Complete</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
